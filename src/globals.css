@import 'tailwindcss';
@import '@fuma-comment/react/preset.css';

@plugin '@tailwindcss/container-queries';
@plugin 'tailwindcss-animate';

@theme static {
  --sh-identifier: #171717;
  --sh-sign: #8996a3;
  --sh-property: hsl(278.93deg 100% 36.12%);
  --sh-entity: hsl(210.8deg 100% 38.9%);
  --sh-jsxliterals: #6266d1;
  --sh-string: hsl(138.58deg 77.94% 27.65%);
  --sh-keyword: rgb(215, 58, 73);
  --sh-comment: #a19595;
}

@theme {
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);

  --breakpoint-xs: 390px;
  --breakpoint-sm: 435px;
  --breakpoint-md: 768px;
  --breakpoint-lg: 1024px;
  --breakpoint-xl: 1280px;

  --animate-reveal: reveal 0.7s ease-in-out;
}

/*
  The default border color has changed to `currentColor` in Tailwind CSS v4,
  so we've added these compatibility styles to make sure everything still
  looks the same as it did with Tailwind CSS v3.

  If we ever want to remove these styles, we need to add an explicit border
  color utility to any element that depends on these defaults.
*/
@layer base {
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--color-gray-200, currentColor);
  }

  ::selection {
    @apply bg-black text-white;
  }

  html,
  body {
    @apply bg-white;
  }

  html {
    @apply overflow-hidden scroll-smooth antialiased;
    text-size-adjust: 100%;
    -webkit-text-size-adjust: 100%;
    text-rendering: optimizeLegibility;
  }

  body {
    @apply font-sans text-base text-gray-900;
  }

  [data-radix-portal] {
    position: relative;
    z-index: 60;
    isolation: isolate;
  }

  [data-radix-popper-content-wrapper] {
    z-index: 70;
  }

  [role='dialog'][data-state] {
    z-index: 1000;
  }

  [data-state][class*='overlay'] {
    z-index: 900;
  }

  [role='dialog'][data-state] .bg-fc-popover {
    opacity: 1;
  }

  [data-radix-portal] .bg-fc-popover,
  [data-radix-portal] .bg-fc-card,
  [data-radix-portal] .bg-fc-background {
    opacity: 1;
  }

  /* 为中文文本添加思源宋体 */
  :lang(zh),
  [lang='zh'],
  .chinese-text {
    font-family: 'Noto Serif SC', 'Source Han Serif SC', '思源宋体', serif;
  }

  /* 为写作页面添加霞鹜文楷字体 */
  .writing-content,
  .writing-content * {
    font-family: 'LXGW WenKai', '霞鹜文楷', 'Noto Serif SC', serif;
  }

  /* 确保写作页面的内容使用霞鹜文楷 */
  .writing-content .content,
  .writing-content .content * {
    font-family: 'LXGW WenKai', '霞鹜文楷', 'Noto Serif SC', serif;
  }

  /* 针对写作页面的特定样式 */
  .writing-content h1,
  .writing-content h2,
  .writing-content h3,
  .writing-content h4,
  .writing-content h5,
  .writing-content h6,
  .writing-content p,
  .writing-content li,
  .writing-content blockquote,
  .writing-content article,
  .writing-content .prose {
    font-family: 'LXGW WenKai', '霞鹜文楷', 'Noto Serif SC', serif;
  }

  #__next {
    @apply min-h-dvh;
  }

  article {
    @apply flex flex-col;
  }

  p {
    @apply mb-6 leading-[1.75];
  }

  a,
  button {
    @apply cursor-pointer outline-hidden;
  }

  a {
    @apply transition-colors duration-300;
  }

  button:focus-visible {
    @apply outline-2 outline-offset-2 outline-gray-950;
  }

  button:disabled,
  button[disabled] {
    @apply cursor-not-allowed;
  }

  h1,
  h2,
  h3 {
    @apply scroll-mt-16 font-semibold tracking-tighter text-black slashed-zero lg:scroll-mt-8;
  }

  h1 {
    @apply text-2xl md:text-3xl;
  }

  h2 {
    @apply text-lg md:text-xl;
  }

  h3 {
    @apply md:text-lg;
  }

  h2 + h3 {
    @apply mt-0!;
  }

  ol {
    li::marker {
      @apply font-semibold;
    }
  }

  ul {
    li {
      @apply pl-2;

      &::marker {
        @apply text-gray-400;
      }
    }
  }

  li div {
    @apply inline;
  }

  li p,
  li div,
  li h1,
  li h2 {
    @apply my-0;
  }

  hr {
    @apply my-6 border-gray-200;
  }

  img,
  object {
    @apply rounded-xl border;
  }

  pre {
    @apply bg-white px-0 py-5 text-[13px];

    code {
      @apply grid text-left font-mono text-[13px] break-normal whitespace-pre;
      counter-reset: sh-line-number;

      .sh__line {
        @apply relative min-w-max px-4;

        &:before {
          @apply mr-6 inline-block w-5 text-right text-gray-400 tabular-nums;
          counter-increment: sh-line-number 1;
          content: counter(sh-line-number);
        }
      }
    }
  }

  lite-youtube {
    @apply max-w-full! overflow-hidden rounded-xl;
  }
}

/* ==========================================================================
   HARDENING LAYER: Accessibility & Edge Cases
   ========================================================================== */

/* --- Reduced Motion Preference (WCAG 2.3.3) --- */
@media (prefers-reduced-motion: reduce), (update: slow) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }

  .animate-reveal {
    animation: none !important;
    opacity: 1 !important;
    filter: none !important;
    transform: none !important;
  }
}

/* --- High Contrast Mode Support (WCAG 1.4.11) --- */
@media (prefers-contrast: more), (-ms-high-contrast: active) {
  :focus-visible {
    outline: 2px solid currentColor !important;
    outline-offset: 2px !important;
  }

  button,
  a {
    border: 1px solid currentColor !important;
  }

  img {
    filter: contrast(1.2);
  }
}

/* --- Forced Color Mode --- */
@media (forced-colors: active) {
  .thumbnail-shadow {
    border: 1px solid CanvasText;
  }

  [data-state][class*='overlay'] {
    background-color: Canvas;
  }

  button:disabled {
    opacity: 0.5;
  }
}

/* --- RTL (Right-to-Left) Language Support --- */
/* 使用逻辑属性而非方向属性 */
[dir='rtl'] {
  /* 翻转外部链接图标 */
  .link[target='_blank'] .after\:content-\[\'\_\↗\'\]::after {
    content: '↖' !important;
  }

  /* 导航翻转 */
  [dir='rtl'] .side-menu {
    border-left: none !important;
    border-right: 1px solid;
  }
}

/* 逻辑属性 - 自动适配 LTR/RTL */
.logical-margin-start {
  margin-inline-start: 1rem;
}

.logical-margin-end {
  margin-inline-end: 1rem;
}

.logical-padding {
  padding-inline: 1rem;
}

.logical-border-end {
  border-inline-end: 1px solid;
}

/* --- Text Overflow & Wrapping --- */
/* 防止 flex 子元素溢出 */
.flex-overflow-safe {
  min-width: 0;
  overflow: hidden;
}

/* 长文本换行 */
.text-wrap-safe {
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
}

/* --- Touch Target Size (WCAG 2.5.5) --- */
/* 最小 44x44px 触摸目标 */
.touch-target-safe {
  min-height: 44px;
  min-width: 44px;
}

/* --- Focus Visible Enhancement --- */
/* 移除全局的 outline-hidden，改为 focus-visible */
.focus-visible-enhanced:focus-visible {
  @apply outline-2 outline-offset-2 outline-gray-950;
}

/* ==========================================================================
   UTILITY LAYER: Enhanced Text Handling
   ========================================================================== */
@utility text-balance {
  text-wrap: balance;
}

@utility truncate-multiline {
  display: -webkit-box;
  -webkit-line-clamp: var(--line-clamp, 2);
  -webkit-box-orient: vertical;
  overflow: hidden;
}

@utility container-safe {
  max-width: 100%;
  overflow-x: hidden;
}

/* ==========================================================================
   ANIMATION LAYER: Performance-optimized animations
   ========================================================================== */

/* CSS keyframes for component animations - GPU accelerated */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Pulse light animation for active states */
@keyframes pulse-light {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}

.animate-pulse-light {
  animation: pulse-light 2s ease-in-out infinite;
}

/* Slide in from left */
@keyframes slide-in-from-left {
  from {
    opacity: 0;
    transform: translateX(-10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.animate-slide-in-from-left {
  animation: slide-in-from-left 0.3s ease-out;
}

/* Scale in animation */
@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.animate-scale-in {
  animation: scale-in 0.4s ease-out;
}

/* Performance: Use will-change sparingly */
.will-change-transform-opacity {
  will-change: transform, opacity;
}

/* ==========================================================================
   ENTRANCE ANIMATION UTILITIES
   ========================================================================== */

/* Stagger animation container - use with children that have animate-in classes */
.stagger-children > * {
  animation: fadeIn 0.5s ease-out forwards;
  opacity: 0;
}

.stagger-children > *:nth-child(1) { animation-delay: 0ms; }
.stagger-children > *:nth-child(2) { animation-delay: 80ms; }
.stagger-children > *:nth-child(3) { animation-delay: 160ms; }
.stagger-children > *:nth-child(4) { animation-delay: 240ms; }
.stagger-children > *:nth-child(5) { animation-delay: 320ms; }
.stagger-children > *:nth-child(6) { animation-delay: 400ms; }
.stagger-children > *:nth-child(7) { animation-delay: 480ms; }
.stagger-children > *:nth-child(8) { animation-delay: 560ms; }

/* Quick stagger for denser content */
.stagger-children-fast > * {
  animation: fadeIn 0.3s ease-out forwards;
  opacity: 0;
}

.stagger-children-fast > *:nth-child(1) { animation-delay: 0ms; }
.stagger-children-fast > *:nth-child(2) { animation-delay: 50ms; }
.stagger-children-fast > *:nth-child(3) { animation-delay: 100ms; }
.stagger-children-fast > *:nth-child(4) { animation-delay: 150ms; }
.stagger-children-fast > *:nth-child(5) { animation-delay: 200ms; }
.stagger-children-fast > *:nth-child(6) { animation-delay: 250ms; }
.stagger-children-fast > *:nth-child(7) { animation-delay: 300ms; }
.stagger-children-fast > *:nth-child(8) { animation-delay: 350ms; }

/* Hero entrance animation */
.hero-entrance {
  animation: hero-reveal 0.6s ease-out;
}

@keyframes hero-reveal {
  from {
    opacity: 0;
    transform: scale(0.95);
    filter: blur(10px);
  }
  to {
    opacity: 1;
    transform: scale(1);
    filter: blur(0);
  }
}

/* Title underline animation */
.title-underline {
  position: relative;
}

.title-underline::after {
  content: '';
  position: absolute;
  bottom: -4px;
  left: 0;
  width: 0;
  height: 2px;
  background: currentColor;
  transition: width 0.3s ease;
}

.title-underline:hover::after,
.group:hover .title-underline::after {
  width: 100%;
}

@utility link-card {
  @apply -mx-1.5 -my-1 rounded-sm bg-transparent px-1.5 py-1 transition-colors duration-300 hover:bg-gray-200;
}

@utility content-wrapper {
  @apply z-1 w-full px-6 pt-8 pb-8 lg:px-8 lg:pt-24 lg:pb-16;
}

@utility content {
  @apply mx-auto w-full lg:mb-0 lg:max-w-3xl;
}

@utility link {
  @apply text-blue-600 hover:underline hover:underline-offset-4;
}

@utility inline-code {
  @apply inline-block rounded-md bg-gray-100 px-0.5 py-0.5 text-sm not-italic before:content-['`'] after:content-['`'];
}

@utility thumbnail-shadow {
  box-shadow:
    0 0 0 0.5px #e2e8f0,
    0 0 0 1px rgba(226, 232, 240, 0.5),
    0 0 0 3px #f8fafc,
    0 0 0 3.5px #f1f5f9,
    0 10px 15px -3px rgb(59 130 246/5%),
    0 4px 6px -4px rgb(59 130 246/5%);
}

@utility scrollable-area {
  @apply h-full max-h-dvh min-h-dvh overflow-x-hidden overflow-y-auto;
}

@utility horizontal-scroll-area {
  @apply block w-fit min-w-full grow;
}

@utility word-break-word {
  word-break: break-word;
}

@utility px-safe {
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
}

@utility bg-dots {
  @apply bg-white bg-[radial-gradient(#e5e7eb_1px,transparent_1px)] [background-size:16px_16px];
}

@utility bg-grid {
  @apply bg-white bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px];
}

@keyframes reveal {
  0% {
    opacity: 0;
    filter: brightness(1) blur(15px);
    scale: 1.0125;
  }
  10% {
    opacity: 1;
    filter: brightness(1.25) blur(10px);
  }
  100% {
    opacity: 1;
    filter: brightness(1) blur(0);
    scale: 1;
  }
}

/* --- Markdown 表格美化: 默认带边框，hover 高亮 --- */
.prose table {
  @apply w-full overflow-hidden rounded-lg border border-gray-200 transition-shadow;
}
.prose thead th {
  @apply border-b border-gray-200 bg-gray-50 px-3 py-2 text-left font-semibold text-gray-700;
}
.prose tbody td {
  @apply border-b border-gray-100 px-3 py-2;
}
.prose tr:last-child td {
  @apply border-b-0;
}
.prose tbody tr {
  @apply transition-colors;
}
.prose tbody tr:hover {
  @apply border-l-4 border-blue-400 bg-blue-50/40 shadow-md;
}
